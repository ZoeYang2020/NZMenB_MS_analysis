#devtools::install_github("xavierdidelot/BactDating")

setwd("/home/zyang/NGS/active/IPL/MENINGO/analysis/HRC/zoe/AllNZMemB_2021/bactdating/2371_dating")

library(BactDating)
library(ape)
library(ggplot2)
set.seed(0)
#?BactDating
getwd()
tre_42=loadCFML(prefix='./clade42_2372clonalframeml')
tre_42$tip.label
#clade42_2371IDs<-tre_42$tip.label
#clade42_2371IDs
#write.csv(clade42_2371IDs,"./clade42_2371IDs.csv", row.names = FALSE)

dates=c(1990.877,1992.127,1999.655,2000.116,2001.488,2002.797,2005.362,2003.318,2002.598,2001.893,2002.546,2000.855,2001.264,2001.671,2013.661,1998.639,2003.559,2003.346,2003.102,1994.959,1996.042,2001.803,2000.532,1994.625,1995.373,1995.877,1996.042,1999.652,1999.775,1996.458,1998.447,1998.441,1999.392,1996.710,1997.069,2002.693,1999.732,1997.203,1999.828,2002.326,2002.324,2003.767,2003.666,2007.488,2003.751,2002.411,1995.044,1995.959,1996.458,1997.406,1999.893,1998.346,2000.469,2003.669,2006.343,2009.669,2008.491,2011.598,1996.625,1998.513,2005.444,1995.710,1999.934,1998.775,2001.003,2003.031,1992.625,2000.088,2001.726,1993.458,1997.702,1997.378,1994.044,1997.773,1993.792,1997.477,1993.877,1997.863,1999.127,1995.458,1996.373,1999.398,1999.751,1999.992,2001.556,2002.551,2002.524,1996.877,2004.031,2000.272,1998.326,1998.608,1998.756,2001.042,1998.888,2000.910,1999.743,2001.655,1999.674,2005.502,2005.099,2005.488,2005.422,2007.556,2013.080,
        2006.644,2005.351,1999.381,1999.168,1994.792,1995.458,2003.023,1996.877,1997.493,2002.064,2000.726,2004.614,2010.896,1995.710,2000.781,1998.050,2001.792,1994.540,2003.792,2002.066,1995.625,1996.458,1996.458,1996.710,1995.625,1997.680,1997.721,1999.806,1997.751,1998.587,2003.929,1998.608,1998.546,2002.644,2003.702,1995.710,2000.647,1996.540,1999.179,1999.729,1999.967,2002.647,2002.266,2003.450,2004.359,2002.042,2003.619,2005.515,2005.042,1998.693,1996.710,2000.474,2000.472,1999.485,1997.745,1998.469,2001.532,2000.951,1998.855,2000.433,2001.573,2001.389,2003.064,2003.841,2006.702,2000.559,2002.962,1995.625,2001.734,1997.504,1997.989,1995.792,1997.529,2001.187,2001.833,2004.058,2015.622,1995.625,1997.666,1998.551,2000.159,2000.392,1999.496,2001.096,1999.526,2000.773,2002.477,2003.921,2004.874,2001.871,2004.819,2000.926,2001.507,2006.381,2006.088,2011.014,2004.379,2005.236,2005.483,2005.294,2007.565,1997.762,1995.625,1998.660,1998.441,1999.713,2000.765,1998.754,1999.973,
        2000.888,2000.981,2005.326,2011.811,2010.995,2002.636,2002.628,2009.981,1999.031,2003.450,2004.693,1992.458,1997.242,1997.663,2002.485,1997.781,2001.061,2001.458,1996.206,1996.206,1997.595,2002.633,1997.502,1996.710,1999.455,1996.291,1998.636,2000.619,2000.608,1998.047,1998.368,1994.625,1996.042,1991.792,1995.458,1996.540,1996.625,1994.792,1996.710,1996.710,1997.365,1995.540,1994.877,1994.877,2001.704,2004.450,2001.910,2004.874,2004.789,2007.532,2007.529,2006.890,1996.291,2000.044,2000.937,2000.992,2004.778,2009.546,2003.699,1995.373,1992.373,1994.540,1994.458,2002.340,1993.373,1998.455,1996.373,1993.373,1996.540,1999.647,1996.625,1998.537,2002.636,1995.044,1998.077,1999.822,2001.485,2003.937,2003.784,2003.321,2000.392,2001.422,2001.860,2001.532,2001.696,2002.592,2004.803,2005.055,2004.296,2002.636,2001.688,2001.688,2001.693,2003.825,2001.693,2005.912,2003.127,2001.849,1999.502,2003.775,1999.647,2000.570,2000.398,2000.721,2003.146,2001.392,2001.510,2002.765,2004.170,2008.515,2002.504,2001.389,
        2001.641,2002.666,2003.576,2005.173,2006.953,2009.811,2011.699,2012.817,2013.699,2014.792,2014.365,2008.855,2009.937,2010.463,2007.819,2001.866,2002.803,2004.433,1995.710,1996.710,1997.584,2000.907,1996.792,2000.411,2004.354,2002.176,2002.524,2003.543,1996.540,1996.792,2001.953,2003.910,2006.841,1998.483,2001.285,1998.964,2004.778,1996.373,2000.518,1996.710,1996.625,1998.948,2014.485,1993.625,1993.710,1996.792,1994.291,1995.625,1996.710,1999.650,2000.269,1999.540,2000.806,2000.713,2005.828,1994.540,1994.458,1995.540,1997.641,2000.978,2001.890,2001.926,1998.576,2001.693,2002.852,2002.759,1997.581,1998.992,2000.639,2000.986,1995.877,1997.901,1996.291,2001.589,1996.291,2000.830,2011.417,2003.650,1997.031,2001.450,1997.619,2000.669,1995.625,2003.483,2003.745,1996.710,1999.409,2000.567,2007.923,2011.414,2001.302,2003.729,1998.847,1999.398,2000.745,2004.608,1994.540,1994.625,1995.710,1998.195,1999.025,1999.340,2006.400,2008.209,2009.285,2010.291,1999.611,1999.800,1999.756,2005.472,2007.926,2008.551,2009.650,2016.307,2009.294,
        2010.540,2005.017,1996.373,1994.710,1995.373,1996.540,1995.625,1995.710,1995.625,2001.050,2001.044,2001.044,1997.014,1999.034,2001.340,2000.677,1997.532,1997.540,1997.682,1998.483,1997.885,2003.863,2003.354,2008.335,2011.373,1998.669,2001.477,2003.901,2004.472,2001.860,2001.734,2005.392,2006.173,2000.198,1998.707,1999.507,2004.773,2000.849,2003.989,2017.603,2003.406,2005.477,1997.981,1998.409,1994.710,1996.792,1997.532,1999.858,1999.154,1999.792,2004.756,2004.521,1999.890,2001.253,2005.904,1999.263,2004.669,1999.529,1999.472,2001.143,2004.209,2001.770,2002.491,2003.671,2000.806,2011.477,2001.283,2002.376,2001.447,2001.715,2004.543,1997.614,2002.291,1999.000,2001.496,1999.650,1999.660,1999.860,2001.608,2004.532,2006.691,2002.014,2004.387,2005.959,2007.781,2011.682,2019.789,1999.214,2003.255,2006.324,1998.472,1999.173,2001.581,2008.633,1993.877,1993.877,1997.548,1997.723,2000.250,2007.562,2009.302,1999.138,1998.589,1999.543,2001.406,2001.912,2002.554,2002.778,2005.819,2015.592,2004.669,2003.710,2004.710,2003.389,2008.250,2011.732,2004.860,2006.173,
        2006.113,2003.606,2004.587,2003.795,2004.515,2004.274,2003.381,2005.201,2003.633,2007.893,2007.198,2003.644,2003.258,2005.786,2003.425,1993.710,1993.710,1994.625,1995.625,1995.959,1997.376,1999.543,1998.743,2002.608,2001.677,2001.828,1997.630,1997.890,1998.578,1996.625,2001.603,2002.521,2001.661,1995.792,2004.929,2000.584,2001.250,2005.499,1995.792,2000.869,1996.540,2001.732,2002.321,1997.039,1998.439,1994.540,2002.368,2002.181,2004.685,2006.726,2011.880,2013.422,2014.376,2015.718,2011.765,2011.650,2004.269,1991.206,1991.792,1991.792,1992.206,1992.625,1992.042,1993.458,1993.710,1995.625,1997.236,2007.357,2008.882,2000.817,2002.266,2007.170,2004.472,1995.625,1995.625,1996.792,1996.540,1996.042,1996.291,1996.959,2001.403,1997.370,1997.567,2009.546,1998.239,1998.239,1997.584,1997.515,1998.630,1999.455,1999.036,1997.450,1997.773,1998.192,1999.674,1996.625,1997.466,1996.042,1996.127,1994.540,1996.291,1996.373,1999.682,1996.540,1996.625,1996.625,1997.581,1997.606,2000.822,2004.567,1999.732,1998.086,1997.264,2000.661,2000.781,2003.526,2004.228,2001.447,2011.652,1996.625,2001.198,
        1993.792,1994.458,1995.206,1995.540,1996.625,1997.639,1997.641,1998.450,2003.578,2004.105,1998.485,1998.855,1999.660,2001.923,2001.628,1997.792,1998.502,2001.132,2003.852,2003.066,2005.039,2006.693,2003.357,2001.559,2001.871,1998.981,1994.877,1995.373,2004.737,1997.625,1997.929,2002.674,2002.324,1997.513,1999.499,2002.472,1998.458,1999.669,2005.554,1994.373,1996.540,1997.006,2001.521,1994.792,1992.042,1993.373,1993.625,1999.420,1995.373,1996.625,2001.140,1996.540,1996.877,1997.833,1997.578,2000.671,1999.179,2001.773,2012.600,1994.625,1995.458,1996.792,1997.699,2000.028,2001.907,2001.266,2001.658,1996.792,1996.127,1996.877,1997.567,1998.370,2001.003,1998.455,2001.201,2003.803,2001.264,2002.025,1999.838,2003.880,2005.502,1998.921,2000.669,1999.044,2000.228,2000.376,2000.305,2000.474,2000.474,1999.113,1997.970,1998.080,2000.242,1997.628,1998.696,2001.409,2000.496,2000.398,2002.535,2002.129,2005.028,1999.740,2000.513,2000.565,2001.003,2001.050,2002.691,2003.389,2005.707,2002.195,2003.425,2003.253,2004.691,2004.496,2001.483,2001.951,2005.316,2000.932,2001.650,2001.570,2001.677,2001.628,2002.439,
        2004.639,2005.537,2001.923,2009.296,2002.565,2002.480,2002.436,2000.600,2001.595,1999.206,1999.636,2002.365,2000.786,1999.866,2001.483,2003.767,2000.392,2002.121,2001.795,2003.546,2003.313,1999.956,2001.507,2007.660,2003.165,2000.310,2001.680,2000.425,2001.047,2000.502,2003.094,2002.000,2007.233,2005.622,2004.901,2005.359,2003.901,2003.510,2003.784,2004.677,2003.734,1997.671,2000.619,2001.173,2003.650,2004.559,2003.521,2005.466,2007.452,2004.803,1997.135,2000.181,2000.392,2003.378,2001.307,2003.565,2000.439,2000.537,2000.658,2002.083,2001.455,2001.455,1997.682,2000.206,2000.614,2001.775,1997.789,1997.789,1999.294,1999.332,2001.061,2000.907,2000.978,2001.589,1998.324,1998.535,2002.600,2002.236,2001.532,2001.529,2003.904,2003.567,2000.828,2000.836,2000.696,2001.463,1997.630,1998.693,2000.890,1997.981,2000.890,1997.381,1998.340,1998.770,2000.124,2003.546,2004.745,2003.428,2003.409,1999.674,2003.524,1999.707,2001.151,2000.715,2001.696,2003.488,2002.614,2004.589,1997.732,2000.584,2000.817,2000.808,2002.567,2003.389,1999.370,2001.682,2004.521,2000.975,2001.184,2002.685,2003.214,1999.617,1995.625,1996.042,2000.329,
        2009.469,1996.540,1996.710,1997.389,1997.551,1996.792,1996.540,1995.625,1995.792,1999.912,2003.280,1997.441,1997.589,1999.272,1995.625,1996.710,1996.710,2000.702,2002.474,2003.518,1995.959,2000.759,2001.622,2005.107,1995.710,2009.795,1996.625,1997.940,1995.540,1998.570,2008.992,2004.354,2004.250,2006.874,2007.088,2004.091,2005.554,1996.792,1996.792,1998.562,2001.515,2011.354,2015.663,1998.844,2004.091,1996.540,1994.625,2000.567,2001.901,1994.373,2003.644,2003.192,2010.291,1991.458,1992.373,1993.373,1993.877,1995.625,1999.836,2001.874,1995.373,1997.526,2000.316,1995.373,1998.551,2001.050,2003.608,2001.721,1996.042,1996.877,1997.819,1996.206,1991.625,1991.877,1993.291,1998.666,1994.373,1996.458,1999.784,2002.518,1995.458,1995.710,1996.127,1994.877,1994.959,1994.877,1994.044,1995.710,1996.710,1994.710,2001.362,1995.625,1994.129,1999.877,2004.190,2017.614,1996.042,2000.493,1992.959,1994.129,1994.625,1994.291,1995.373,1995.625,1992.458,1992.710,1993.710,1992.710,1992.540,1992.625,1992.625,1992.625,1992.625,1993.044,1993.458,2002.781,2002.682,2003.833,2003.176,2009.050,1992.458,1992.540,1992.959,1992.959,1993.129,1993.710,1993.877,1995.625,1996.373,1996.710,1997.923,2003.617,2000.064,2000.723,2001.663,1994.877,1994.877,1996.458,2003.814,1996.710,1997.962,1997.989,1998.318,2001.225,1996.877,2000.740,1997.280,1997.647,2002.343,1998.077,1997.910,1998.392,1999.570,1999.603,2000.841,2001.337,2001.795,2001.384,2001.302,2004.551,2002.529,1999.477,2000.819,2005.247,2006.570,2006.565,2006.499,2000.992,2003.789,2002.255,2003.573,2004.326,2001.573,2001.351,1995.373,1995.959,1997.767,2000.436,2001.608,2002.713,2002.696,1996.877,1999.305,2000.450,2001.598,2003.554,2000.795,2003.072,2001.677,1994.792,1997.537,1998.546,1996.540,1998.222,1998.885,1996.625,1999.567,2011.822,1997.814,1997.762,1999.444,2001.548,2002.020,2003.003,2003.392,2003.305,2003.795,2004.669,2003.562,2002.138,2004.743,2004.165,2004.792,2005.053,2006.871,2008.570,2001.222,2002.849,2003.940,2005.316,2008.852,2003.105,2001.767,2001.778,2003.625,2004.510,2004.203,2006.181,2007.014,2003.691,2003.488,2002.781,2002.756,2002.318,2004.463,2005.138,2008.526,2008.266,2008.409,2005.400,2004.034,2004.433,2000.321,2000.305,2004.915,2012.765,2008.693,2004.441,2002.636,2002.743,2002.006,2001.617,1999.595,2004.190,2008.869,2008.518,2008.622,2007.625,2002.146,2003.346,2003.789,2009.710,2007.926,2009.118,2003.310,2004.507,1998.863,2004.389,2004.606,1994.458,1996.540,2002.693,2002.732,2003.036,2004.129,2004.463,2004.493,2003.797,2003.025,2004.765,2004.964,2003.537,2003.042,2003.699,1996.877,1995.373,1999.321,1993.959,1994.625,1996.127,1996.373,1996.877,1999.450,1998.192,1998.559,1999.608,2001.370,2001.696,2000.671,2003.537,2003.513,2003.485,2011.532,2008.014,2008.009,1997.910,1999.581,2001.417,2003.521,2001.918,2002.567,2004.411,2006.316,2005.431,2001.562,2000.702,1999.762,2000.691,2001.409,2001.702,2001.855,2005.233,2000.702,2002.118,2000.502,1999.250,1999.877,2000.521,1999.844,2000.302,2003.904,2001.858,2003.485,2004.157,2000.075,2000.392,2001.592,2000.729,2005.255,2008.885,2002.469,2003.502,2005.154,2000.641,2000.641,2002.581,2004.034,2003.441,2003.348,2005.548,2006.507,2006.414,2002.734,2005.948,2002.587,1997.258,1999.723,1995.710,1995.710,1996.540,1997.611,1997.663,1997.529,1999.650,1997.658,1996.540,1996.042,1998.433,2003.715,1994.458,1994.877,1994.792,1997.743,2001.436,2003.781,2011.184,2011.715,2012.929,2003.411,2004.912,2005.819,2006.217,2004.704,2004.515,2003.584,2005.901,2010.422,2013.220,2014.860,2016.535,2017.047,2016.997,1996.625,1997.258,1997.329,1994.792,1998.573,2002.346,2002.639,2004.617,2004.740,2004.740,1991.540,1996.540,2000.485,2000.502,2002.647,2004.978,2000.622,2002.754,2001.014,2003.874,2004.069,2007.373,2003.425,1998.044,1999.863,2002.628,2000.044,2000.149,2003.214,2001.603,1990.959,1991.129,1990.625,1997.639,1997.863,1998.918,1999.663,2000.863,1999.849,2000.343,1997.885,1998.765,2005.231,1997.975,1999.529,1999.518,1999.537,2001.562)
dates


#pdf(file="./42_2371root_to_tip_correlation.pdf")
#root_to_tip_correlation <-roottotip(tre_42,dates, rate=NA,permTest = 10000, showFig=T, colored = T,showPredInt = "gamma", showText=T, showTree = T)
#dev.off()


res=bactdate(tre_42,dates,useRec=T, nbIts=1e7)


pdf(file="./421e7_2371MCMCTrace.pdf")
plot(res, 'trace')
dev.off()


pdf(file="./421e7_2371time_Bactdating.pdf")
plot(res,'treeCI')
dev.off()

#export the result
l=as.treedata.resBactDating(res)
l
library(treeio)
obj=methods::new('treedata',phylo=l[[1]],data=dplyr::tbl_df(as.data.frame(l[[2]])))
obj
write.beast(obj,'42_2371_treeBactDating1e7.nex')






