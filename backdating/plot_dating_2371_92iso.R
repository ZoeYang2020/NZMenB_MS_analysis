#devtools::install_github("xavierdidelot/BactDating")


setwd("/home/zyang/NGS/active/IPL/MENINGO/analysis/HRC/zoe/AllNZMemB_2021/20220728_For_Una")

library(BactDating)
library(ape)
library(geiger)
#library(skygrowth)
library(ggplot2)
library(phylodyn)
library(ggtree)
getwd()
ref41_2371_41<-read.nexus("./41_ref41_2371_treeBactDating1e7.nex")
ref41_2371_41
plot(ref41_2371_41)
ggtree(ref41_2371_41, mrsd="2011-3-10")+ theme_tree2()+ geom_tiplab()

svg(file="./41_ref41_2371_treeBactDating1e7.svg")
dev.off()




ref41_2371_41_54<-read.nexus("./41_ref41_54iso_2out_2371_treeBactDating1e7.nex")
ref41_2371_41_54
plot(ref41_2371_41_54)
ggtree(ref41_2371_41_54, mrsd="2007-1-16")+ theme_tree2()+ geom_tiplab()

svg(file="./41_ref41_54iso_2out_2371_treeBactDating1e7.svg")
dev.off()





#ggtree(ref41_2371_41, mrsd="2011-3-10")+ theme_tree2()+ geom_range(range='height_0.95_HPD', color='red', alpha=.6, size=2)



clade_infro<-read.csv("./2371_clade_infor.csv")
clade_infro

p<-ggtree(NZmenB2371, mrsd="2019-12-10")+ theme_tree2()
p

p <- p %<+% clade_infro + geom_tippoint(aes(color=Clade),size=2)+scale_color_manual(values=c("#a1c9f1", "#efb0c9","#ade6d0"))
p+theme(legend.position="right")


svg(file="./2371_dated_tree_3clades.svg")
p+theme(legend.position="right")
dev.off()

#clade42_time
clade42 = c("NMI9029","NMI9043","NMI914","NMI915","NMI9114","NMI9115","NMI9124","NMI9140","NMI9143","NMI9149","NMI9160","NMI924","NMI927","NMI9218","NMI9241","NMI9246","NMI9253","NMI9254","NMI9256","NMI9267","NMI9276","NMI9281","NMI9285","NMI9287","NMI9296","NMI9299","NMI92100","NMI92102","NMI92111","NMI92143","NMI92145","NMI92152","NMI9314","NMI9323","NMI9348","NMI9354","NMI9358","NMI9361","NMI9363","NMI9373","NMI9374","NMI9385","NMI93124","NMI93131","NMI93133","NMI93134","NMI93143","NMI93144","NMI93146","NMI93147","NMI93154","NMI93157","NMI93167","NMI93169","NMI93170","NMI93180","NMI93181","NMI93184","NMI945","NMI9437","NMI9446","NMI9460","NMI9419","NMI9433","NMI9454","NMI94176","NMI94212","NMI94218","NMI9474","NMI94225","NMI9478","NMI9479","NMI9482","NMI9484","NMI94245","NMI9413","NMI9457","NMI94118","NMI9456","NMI94120","NMI94121","NMI94129","NMI94130","NMI9442","NMI94160","NMI94163","NMI9463","NMI9483","NMI94168","NMI94100","NMI94149","NMI94198","NMI94234","NMI94183","NMI94185","NMI9498","NMI94229","NMI94199","NMI943","NMI94208","NMI9426","NMI94101","NMI94231","NMI94233","NMI94240","NMI9510","NMI9527","NMI9545","NMI9546","NMI9549","NMI9550","NMI9551","NMI9554","NMI9555","NMI9565","NMI9567","NMI9569","NMI9571","NMI9572","NMI9574","NMI9580","NMI95174","NMI9597","NMI9599","NMI95105","NMI95111","NMI95125","NMI95132","NMI95135","NMI95136","NMI95140","NMI95141","NMI95143","NMI95153","NMI95154","NMI95155","NMI95157","NMI95159","NMI95176","NMI95177","NMI95178","NMI95179","NMI95181","NMI95182","NMI95183","NMI95196","NMI95187","NMI95192","NMI95206","NMI95207","NMI95208","NMI95211","NMI95213","NMI95216","NMI95217","NMI95218","NMI95227","NMI95236","NMI95242","NMI95246","NMI95258","NMI95283","NMI95284","NMI952","NMI95297","NMI95298","NMI95299","NMI95305","NMI966","NMI969","NMI9610","NMI9611","NMI9615","NMI9628","NMI9629","NMI9624","NMI9626","NMI9630","NMI9632","NMI9635","NMI9637","NMI9643","NMI9651","NMI9652","NMI9654","NMI9657","NMI9658","NMI9673","NMI9671","NMI9672","NMI9674","NMI9684","NMI9689","NMI9691","NMI9692","NMI9697","NMI9698","NMI96103","NMI96119","NMI96120","NMI96125","NMI96122","NMI96123","NMI96126","NMI96128","NMI96132","NMI96133","NMI96141","NMI96144","NMI96145","NMI96157","NMI96167","NMI96173","NMI96174","NMI96175","NMI96178","NMI96179","NMI96188","NMI96189","NMI96197","NMI96198","NMI96200","NMI96201","NMI96202","NMI96209","NMI96217","NMI96219","NMI96221","NMI96225","NMI96226","NMI96230","NMI96231","NMI96242","NMI96229","NMI96233","NMI96243","NMI96244","NMI96245","NMI96246","NMI96247","NMI96249","NMI96250","NMI96254","NMI96256","NMI96257","NMI96263","NMI96265","NMI96268","NMI96279","NMI96276","NMI96277","NMI96286","NMI96288","NMI96289","NMI96291","NMI96297","NMI96299","NMI96300","NMI96304","NMI96306","NMI96309","NMI96310","NMI96311","NMI96316","NMI96319","NMI96320","NMI96323","NMI96325","NMI964","NMI965","NMI96326","NMI974","NMI975","NMI9712","NMI9713","NMI9718","NMI9728","NMI9734","NMI9737","NMI9742","NMI9746","NMI9754","NMI9757","NMI9762","NMI9769","NMI9770","NMI9773","NMI9774","NMI9775","NMI9779","NMI9781","NMI9792","NMI97184","NMI9793","NMI97100","NMI97111","NMI97116","NMI97135","NMI97143","NMI97138","NMI97139","NMI97140","NMI97147","NMI97149","NMI97151","NMI97153","NMI97158","NMI97159","NMI97160","NMI97162","NMI97163","NMI97179","NMI97180","NMI97187","NMI97191","NMI97195","NMI97198","NMI97210","NMI97211","NMI97213","NMI97218","NMI97220","NMI97221","NMI97223","NMI97225","NMI97235","NMI97239","NMI97241","NMI97242","NMI97243",
            "NMI97244","NMI97245","NMI97251","NMI97253","NMI97255","NMI97259","NMI97268","NMI97269","NMI97270","NMI97272","NMI97279","NMI97284","NMI97293","NMI97295","NMI97309","NMI97311","NMI97314","NMI97320","NMI97321","NMI97324","NMI97323","NMI97330","NMI97331","NMI97333","NMI97335","NMI97339","NMI97340","NMI97347","NMI97351","NMI97353","NMI97358","NMI97362","NMI97366","NMI97368","NMI97370","NMI97374","NMI97377","NMI97378","NMI97380","NMI97382","NMI97388","NMI97396","NMI97402","NMI97403","NMI97404","NMI97405","NMI97408","NMI97409","NMI989","NMI9810","NMI9813","NMI9816","NMI9817","NMI9822","NMI9823","NMI9836","NMI9837","NMI9838","NMI9843","NMI9848","NMI9849","NMI9862","NMI9863","NMI9864","NMI9865","NMI9869","NMI9872","NMI9873","NMI9878","NMI9882","NMI9885","NMI9887","NMI9888","NMI9893","NMI9894","NMI9898","NMI9899","NMI98100","NMI98104","NMI98109","NMI98110","NMI98119","NMI98120","NMI98122","NMI98139","NMI98132","NMI98141","NMI98142","NMI98143","NMI98146","NMI98147","NMI98154","NMI98156","NMI98157","NMI98161","NMI98162","NMI98164","NMI98166","NMI98167","NMI98169","NMI98182","NMI98186","NMI98194","NMI98195","NMI98203","NMI98204","NMI98206","NMI98207","NMI98220","NMI98222","NMI98223","NMI98228","NMI98244","NMI98250","NMI98252","NMI98254","NMI98257","NMI98258","NMI98270","NMI98271","NMI98272","NMI98273","NMI98276","NMI98282","NMI98284","NMI98289","NMI98296","NMI98294","NMI98297","NMI98300","NMI98302","NMI98306","NMI994","NMI995","NMI997","NMI999","NMI9913","NMI9922","NMI9924","NMI9927","NMI9928","NMI9931","NMI9932","NMI9933","NMI9935","NMI9940","NMI9941","NMI9944","NMI9946","NMI9947","NMI9948","NMI9953","NMI9954","NMI9956","NMI9958","NMI9965","NMI9969","NMI9970","NMI9971","NMI9972","NMI9977","NMI9978","NMI9985","NMI9987","NMI9991","NMI9993","NMI99100","NMI99107","NMI99109","NMI99112","NMI99117","NMI99121","NMI99113","NMI99120","NMI99126","NMI99127","NMI99128","NMI99132","NMI99136","NMI99137","NMI99138","NMI99147","NMI99148","NMI99153","NMI99158","NMI99159","NMI99161","NMI99163","NMI99164","NMI99166","NMI99169","NMI99171","NMI99173","NMI99176","NMI99177","NMI99178","NMI99180","NMI99181","NMI99182","NMI99183","NMI99196","NMI99198","NMI99197","NMI99199","NMI99207","NMI99208","NMI99211","NMI99220","NMI99223","NMI99224","NMI99225","NMI99228","NMI99229","NMI99233","NMI99235","NMI99237","NMI99240","NMI99243","NMI99246","NMI99248","NMI99252","NMI99253","NMI99255","NMI99258","NMI99261","NMI99262","NMI99265","NMI99275","NMI99276","NMI99277","NMI99278","NMI99280","NMI99281","NMI99287","NMI99290","NMI99292","NMI99293","NMI99300","NMI99301","NMI99302","NMI99306","NMI007","NMI008","NMI009","NMI0011","NMI0012","NMI0014","NMI0016","NMI0023","NMI0024","NMI0028","NMI0033","NMI0034","NMI0035","NMI0037","NMI0039","NMI0040","NMI0043","NMI0046","NMI0048","NMI0049","NMI0050","NMI0051","NMI0053","NMI0059","NMI0061","NMI0065","NMI0074","NMI0078","NMI0079","NMI0080","NMI0081","NMI0085","NMI0091","NMI0092","NMI0093","NMI0086","NMI0088","NMI0096","NMI0099","NMI00103","NMI00105","NMI00106","NMI00107","NMI00108","NMI00113","NMI00116","NMI00118","NMI00120","NMI00127","NMI00129","NMI00119","NMI00124","NMI00125","NMI00131","NMI00139","NMI00140","NMI00141","NMI00144","NMI00145","NMI00146","NMI00148","NMI00157","NMI00159","NMI00158","NMI00160","NMI00161","NMI00162","NMI00163","NMI00164","NMI00167","NMI00170","NMI00171","NMI00175","NMI00180","NMI00181","NMI00182","NMI00185","NMI00176","NMI00177","NMI00183","NMI00189","NMI00192","NMI00194","NMI00196","NMI00203","NMI00205",
            "NMI00206","NMI00207","NMI00211","NMI00212","NMI00216","NMI00217","NMI00219","NMI00223","NMI00225","NMI00229","NMI00231","NMI00232","NMI00234","NMI00236","NMI00240","NMI00241","NMI00242","NMI00249","NMI00250","NMI00252","NMI00255","NMI00256","NMI00257","NMI00259","NMI00260","NMI00261","NMI00262","NMI00265","NMI00266","NMI00267","NMI00269","NMI00270","NMI00271","NMI00272","NMI00273","NMI00275","NMI00277","NMI00278","NMI00279","NMI00286","NMI00287","NMI00289","NMI00290","NMI00292","NMI00293","NMI00294","NMI00296","NMI00297","NMI00298","NMI011","NMI015","NMI018","NMI019","NMI0110","NMI0112","NMI0115","NMI0119","NMI0122","NMI0123","NMI0127","NMI0131","NMI0132","NMI0133","NMI0134","NMI0137","NMI0139","NMI0140","NMI0141","NMI0142","NMI0147","NMI0149","NMI0151","NMI0152","NMI0153","NMI0157","NMI0158","NMI0161","NMI0163","NMI0165","NMI0167","NMI0168","NMI0175","NMI0176","NMI0180","NMI0182","NMI0184","NMI0186","NMI0188","NMI0189","NMI0190","NMI0191","NMI0195","NMI01100","NMI01102","NMI01104","NMI01106","NMI01110","NMI01112","NMI01115","NMI01117","NMI01118","NMI01120","NMI01122","NMI01123","NMI01125","NMI01129","NMI01130","NMI01135","NMI01136","NMI01141","NMI01153","NMI01143","NMI01145","NMI01146","NMI01152","NMI01155","NMI01156","NMI01160","NMI01164","NMI01171","NMI01173","NMI01180","NMI01181","NMI01182","NMI01183","NMI01184","NMI01185","NMI01189","NMI01198","NMI01195","NMI01196","NMI01199","NMI01200","NMI01202","NMI01206","NMI01207","NMI01209","NMI01210","NMI01216","NMI01217","NMI01219","NMI01220","NMI01221","NMI01224","NMI01225","NMI01226","NMI01227","NMI01229","NMI01233","NMI01238","NMI01241","NMI01247","NMI01248","NMI01249","NMI01250","NMI01251","NMI01252","NMI01253","NMI01254","NMI01256","NMI01258","NMI01259","NMI01260","NMI01264","NMI01265","NMI01267","NMI01268","NMI01269","NMI01274","NMI01283","NMI01289","NMI01290","NMI01294","NMI01298","NMI01299","NMI01305","NMI01306","NMI01309","NMI01318","NMI01322","NMI01326","NMI01327","NMI01328","NMI01330","NMI01331","NMI01332","NMI01333","NMI01334","NMI01335","NMI01337","NMI01339","NMI01340","NMI01346","NMI01348","NMI01349","NMI01350","NMI01351","NMI01352","NMI01354","NMI01359","NMI01360","NMI01369","NMI02278","NMI02258","NMI02256","NMI02251","NMI02245","NMI02239","NMI02238","NMI02236","NMI02234","NMI02227","NMI02226","NMI02223","NMI02221","NMI02219","NMI02213","NMI02210","NMI02206","NMI02205","NMI02204","NMI02202","NMI02194","NMI02192","NMI02191","NMI02189","NMI02184","NMI02183","NMI02182","NMI02179","NMI02177","NMI02174","NMI02173","NMI02171","NMI02170","NMI02169","NMI02161","NMI02157","NMI02156","NMI02153","NMI02148","NMI02141","NMI02140","NMI02138","NMI02137","NMI02135","NMI02133","NMI02130","NMI02127","NMI02124","NMI02120","NMI02119","NMI02118","NMI02116","NMI02113","NMI02112","NMI02111","NMI02107","NMI02106","NMI02101","NMI02100","NMI0298","NMI0294","NMI0293","NMI0286","NMI0285","NMI0281","NMI0270","NMI0269","NMI0266","NMI0260","NMI0258","NMI0256","NMI0255","NMI0254","NMI0252","NMI0251","NMI0250","NMI0249","NMI0243","NMI0241","NMI0240","NMI0237","NMI0231","NMI0230","NMI0227","NMI0226","NMI0224","NMI0223","NMI0222","NMI0219","NMI0217","NMI0215","NMI0214","NMI0211","NMI027","NMI026","NMI024","NMI021","NMI03289","NMI03283","NMI03282","NMI03280","NMI03278","NMI03275","NMI03273","NMI03271","NMI03269","NMI03267","NMI03265","NMI03264","NMI03261","NMI03260","NMI03258","NMI03255","NMI03254","NMI03253","NMI03250","NMI03248","NMI03244","NMI03242","NMI03241","NMI03239","NMI03238","NMI03237",
            "NMI03234","NMI03233","NMI03231","NMI03229","NMI03227","NMI03224","NMI03223","NMI03215","NMI03208","NMI03206","NMI03205","NMI03202","NMI03198","NMI03197","NMI03195","NMI03192","NMI03188","NMI03186","NMI03185","NMI03184","NMI03182","NMI03181","NMI03175","NMI03173","NMI03172","NMI03168","NMI03166","NMI03159","NMI03156","NMI03155","NMI03152","NMI03151","NMI03150","NMI03149","NMI03146","NMI03143","NMI03141","NMI03139","NMI03137","NMI03134","NMI03132","NMI03131","NMI03129","NMI03124","NMI03123","NMI03122","NMI03116","NMI03114","NMI03111","NMI03110","NMI03104","NMI03103","NMI03100","NMI0399","NMI0397","NMI0393","NMI0391","NMI0390","NMI0385","NMI0384","NMI0383","NMI0382","NMI0380","NMI0379","NMI0378","NMI0376","NMI0375","NMI0374","NMI0373","NMI0370","NMI0368","NMI0367","NMI0365","NMI0364","NMI0362","NMI0361","NMI0360","NMI0359","NMI0358","NMI0357","NMI0356","NMI0353","NMI0352","NMI0349","NMI0347","NMI0342","NMI0341","NMI0340","NMI0339","NMI0335","NMI0334","NMI0332","NMI0331","NMI0328","NMI0325","NMI0323","NMI0321","NMI0320","NMI0317","NMI0315","NMI0312","NMI0311","NMI0310","NMI039","NMI04212","NMI04210","NMI04207","NMI04203","NMI04202","NMI04199","NMI04194","NMI04191","NMI04187","NMI04183","NMI04181","NMI04178","NMI04176","NMI04173","NMI04172","NMI04171","NMI04168","NMI04167","NMI04166","NMI04164","NMI04163","NMI04158","NMI04156","NMI04149","NMI04147","NMI04144","NMI04143","NMI04142","NMI04138","NMI04135","NMI04134","NMI04132","NMI04126","NMI04124","NMI04123","NMI04122","NMI04120","NMI04116","NMI04114","NMI04107","NMI04103","NMI04101","NMI0497","NMI0495","NMI0493","NMI0492","NMI0491","NMI0490","NMI0489","NMI0487","NMI0483","NMI0481","NMI0479","NMI0477","NMI0475","NMI0474","NMI0470","NMI0468","NMI0467","NMI0465","NMI0462","NMI0457","NMI0456","NMI0452","NMI0451","NMI0449","NMI0448","NMI0450","NMI0444","NMI0441","NMI0436","NMI0434","NMI0430","NMI0429","NMI0428","NMI0427","NMI0423","NMI0421","NMI0419","NMI0417","NMI0415","NMI0414","NMI0412","NMI0411","NMI0410","NMI049","NMI046","NMI045","NMI044","NMI05168","NMI05164","NMI05159","NMI05157","NMI05154","NMI05145","NMI05143","NMI05141","NMI05139","NMI05127","NMI05117","NMI05102","NMI0596","NMI0595","NMI0594","NMI0588","NMI0585","NMI0583","NMI0582","NMI0581","NMI0579","NMI0578","NMI0575","NMI0573","NMI0570","NMI0567","NMI0561","NMI0559","NMI0558","NMI0557","NMI0555","NMI0553","NMI0551","NMI0548","NMI0547","NMI0545","NMI0541","NMI0540","NMI0537","NMI0535","NMI0533","NMI0531","NMI0530","NMI0529","NMI0528","NMI0524","NMI0520","NMI0515","NMI0513","NMI0511","NMI059","NMI057","NMI052","NMI051","NMI06131","NMI06126","NMI06123","NMI06120","NMI06119","NMI06107","NMI06102","NMI06101","NMI0699","NMI0690","NMI0681","NMI0679","NMI0663","NMI0660","NMI0649","NMI0647","NMI0646","NMI0641","NMI0639","NMI0637","NMI0631","NMI0627","NMI0626","NMI0623","NMI0617","NMI0614","NMI0792","NMI0791","NMI0790","NMI0785","NMI0782","NMI0778","NMI0767","NMI0762","NMI0755","NMI0753","NMI0751","NMI0750","NMI0749","NMI0740","NMI0736","NMI0733","NMI0730","NMI0723","NMI0720","NMI0718","NMI079","NMI073","NMI0896","NMI0894","NMI0891","NMI0889","NMI0888","NMI0866","NMI0863","NMI0857","NMI0853","NMI0849","NMI0847","NMI0845","NMI0844","NMI0834","NMI0830","NMI0826","NMI0824","NMI0820","NMI086","NMI084","NMI09104","NMI0994","NMI0993","NMI0982","NMI0976","NMI0974","NMI0948","NMI0946","NMI0939","NMI0931","NMI0930","NMI0929","NMI0926","NMI0917","NMI098","NMI092","NMI1074","NMI1035","NMI1028","NMI1020","NMI1017","NMI101","NMI1189",
            "NMI1186","NMI1185","NMI1180","NMI1174","NMI1168","NMI1165","NMI1163","NMI1156","NMI1150","NMI1144","NMI1133","NMI1130","NMI1125","NMI1124","NMI1120","NMI1119","NMI1113","NMI112","NMI111","NMI1264","NMI1258","NMI1256","NMI1233","NMI1344","NMI1341","NMI1320","NMI138","NMI135","14MI0035","14MI0033","14MI0019","14MI0013","14MI0012","15MI0034","15MI0030","15MI0021","15MI0019","16MI0015","16MI0033","17MI0008","17MI0038","17MI0043","17MI0003","NMI1042","NMI0838","19MI0104")
clade42


clade42_tree<- keep.tip(NZmenB2371, clade42)
clade42_tree

ggtree(clade42_tree, mrsd="2019-10-14")+ theme_tree2()+ geom_range(range='height_0.95_HPD', color='red', alpha=.6, size=2)







mcmc42<-read.nexus("./42_2371_treeBactDating1e7.nex")
mcmc42
plot(mcmc42)
ggtree(mcmc42, mrsd="2019-12-10")+ theme_tree2()+ geom_tiplab()

cladeA = c("NMI9039","NMI9217")
nout_outg_42tree<- drop.tip(mcmc42, cladeA)
nout_outg_42tree
ggtree(nout_outg_42tree, mrsd="2019-10-14")+ theme_tree2()
#write.tree(nout_outg_42tree, './nout_outg_42tree.nex')

partition_42_5tips<-read.csv("./42_5tips_partitions.csv")
partition_42_5tips

p2<-ggtree(nout_outg_42tree, mrsd="2019-12-10")+ theme_tree2()
p2

p2 <- p2 %<+% partition_42_5tips + geom_tippoint(aes(color=partition),size=2)
p2+theme(legend.position="right")


svg(file="./noout_42_time_7partitions.svg")
p2+theme(legend.position="right")
dev.off()





set.seed(123)

#?BactDating
t=loadCFML(prefix='./154clonalframeml.out')
t$tip.label
clade154IDs<-t$tip.label
clade154IDs
#write.csv(clade154IDs,"./clade154IDs.csv", row.names = FALSE)

dates=c(1990.877,1992.127,2003.639,2014.461,2014.526,2017.003,2017.600,2017.841,2017.765,2013.532,2016.348,2016.578,2019.693,2017.181,2017.535,2017.535,2017.562,2019.786,2017.718,2017.743,2019.685,2016.877,2016.912,2017.433,2017.784,2018.094,2016.874,2016.885,2016.548,2016.625,2017.359,2019.945,2018.688,2019.053,2019.088,2019.305,2019.628,2018.858,2019.376,2019.828,2017.775,2019.025,2017.797,2016.633,2018.458,2019.808,2018.663,2015.496,2003.485,2000.348,2004.838,2008.515,1995.959,1996.540,2003.603,2003.691,2003.699,2003.099,2004.967,1997.666,1999.458,2001.852,1999.469,2011.250,1994.625,1995.710,1994.625,1996.291,1999.463,1995.710,1995.710,1995.792,1995.959,1998.225,1994.792,1994.792,1995.877,1996.458,1996.458,1996.540,1993.458,1992.373,2000.480,2003.529,2005.838,1998.751,1998.102,2002.000,2002.622,2003.715,2000.956,1997.515,1994.373,1999.305,1999.217,1994.291,1993.458,1994.373,2000.499,2001.047,2001.474,1996.877,1999.441,1999.441,1991.877,2002.529,2002.406,2003.781,1993.540,1994.625,1992.792,2001.540,2001.540,2002.061,1998.680,2003.521,1997.723,1997.723,1996.710,1994.792,1994.540,1995.625,1997.647,1999.866,1993.540,1995.710,1998.266,1997.088,1993.959,1994.792,2001.680,2005.918,1995.540,1991.877,1992.042,1993.129,1990.959,1999.828,2000.422,2001.398,2001.688,2001.688,2002.228,2003.488,2004.280,2005.020,2004.578,1999.655,1999.335,1995.877,1996.042,1996.042,2011.644,1998.874,1999.493,1994.625,2002.023,2002.992,1999.357,1995.540,1995.540,2001.817,2001.773,2001.765,2001.765,2002.737,2004.414,2008.921,2009.025,2008.795,2004.713,2008.912,2004.406,2002.984,2003.608,2004.904,2004.754,2002.458,1997.636,1997.636,2008.395,2011.691,2001.088,2001.047,2003.077,1998.669,1999.803,1997.600,1997.838,1997.838,1997.666,2004.584,2004.732,2004.734,2004.370,1997.543,1996.458,1995.625,1993.044,1993.540,1994.959,1993.792,1993.877,1993.044,1994.792,1992.710,1991.877,1992.042,1992.625,1996.959,2000.767,2002.406,2002.406,1996.540,1996.540,2001.570,2002.220,2003.849,2004.855,2004.441,1997.107,1998.737,1999.784,1999.513,2001.921,1999.743,1999.228,1995.373,1995.625,1997.671,1999.723,1997.307,1996.540,1998.496,1992.792,1997.696,1993.540,1997.455,1998.754,2007.017,1999.671,1996.792,1995.129,1997.258,1996.625,2000.578,1997.420,1996.625,1999.680,2000.121,2001.335,1998.299,2002.600,2006.499,2004.028,1998.885,2001.628,2002.543,2003.014,2005.359,2003.409,2005.472,2005.537,2006.880,2007.715,2007.756,2002.543,2003.546,2003.978,2004.866,2004.740,2005.874,2011.253,2005.496,2006.433,2010.321,2000.795,1996.877,2000.162,1999.630,2006.518,2006.589,1996.540,1997.406,1999.055,1997.014,2001.619,1998.603,1998.603,2000.337,2002.740,2006.951,2006.294,2006.551,2002.395,2001.274,2000.357,1998.904,1998.630,1995.792,2011.600,2011.625,1998.595,1999.181,1995.540,1996.458,1995.877,1996.291,1999.012,1995.877,2000.140,1999.548,2000.450,2000.570,2000.570,2001.066,2000.321,2000.444,1999.543,2002.587,2001.619,2000.373,2001.359,1995.540,1996.625,1995.792,2003.992,2001.606,2001.619,2006.934,2001.754,2003.118,2002.463,1999.781,2002.655,1995.710,2001.671,2002.499,2003.696,1999.901,1998.480,1994.792,1994.044,1997.406,1996.042,1998.094,2000.989,2001.598,1999.781,1999.962,1997.044,2004.751,2005.647,2006.652,2004.611,1998.458,2000.677,2004.173,1997.647,2003.537,1995.458,1995.625,1998.598,1996.959,1999.535,2000.781,2004.025,2001.069,1997.951,1997.951,1996.540,1994.792,1994.877,1994.540,1996.540,1996.540,1996.540,1996.540,2000.518,2000.318,1999.562,1999.102,1996.959,2001.179,1992.792,2000.537,2001.581,2001.211,2001.211,2001.513,2001.734,2001.740,1996.291,2001.307,2002.088,1997.677,2000.699,1999.080,1998.543,1993.129,1993.792,1995.373,1994.877,1994.792,1994.792,2000.775,2000.296,2001.493,2001.518,1999.893,1998.630,2002.669,2002.811,2002.452,1997.811,1997.729,1998.578,1997.806,1998.912,1997.674,1997.436,2001.455,2001.543,1997.463,1997.685,1999.532,2001.658,2001.658,1998.433,1997.502,1998.324,2003.406,2000.833,2002.885,1999.644,1998.584,1998.195,1996.959,1992.792,2000.806,2002.589,2002.543,2003.017,2003.513,2003.513,2003.513,1997.351,1997.381,1998.754,2002.299,2005.335,
        1997.775,2001.422,1997.496,1997.521,1997.521,2000.737,2001.365,2005.915,1999.253,1999.943,2002.803,1999.099,1996.625,1996.877,1997.502,1997.622,1999.923,2003.581,1997.346,1993.792,2000.680,2001.765,2002.540,2000.220,1998.882,1994.625,2001.540,2001.713,1999.795,1999.981,2002.606,1999.759,1999.759,2005.061,1997.559,1997.932,2001.239,2002.225,2002.825,2003.576,1998.567,1998.729,2006.565,1995.792,1995.792,1995.044,1994.625,2000.948,1994.959,1995.792,1995.792,1997.107,2001.014,1998.496,2001.932,1999.044,2002.680,2003.272,2002.359,2003.625,2007.677,2003.222,2004.893,1995.291,1994.625,1995.959,1995.959,1996.373,1996.373,1998.565,1999.491,1995.540,1995.540,1997.258,1997.258,1998.236,1994.710,1995.291,1995.625,1996.540,2001.321,2009.294,1997.756,1999.778,1994.540,1999.940,1997.578,1999.526,1998.461,1998.461,2001.280,1996.625,1996.458,1994.710,1994.710,1995.540,1993.044,2005.020,1996.373,1993.792,1996.710,1996.291,1999.978,1995.206,1993.710,1995.877,2013.091,1997.595,1997.595,1998.201,1998.573,1999.713,1999.370,1995.625,2001.726,1995.792,1995.458,1992.127,1992.127,2012.745,1994.625,1995.458,1996.042,1997.127,1993.291,2001.751,1995.792,1998.211,2000.116,1999.704,2001.592,1995.625,1995.044,1994.373,1994.373,1995.625,1997.740,1998.031,1997.740,1997.414,1996.625,1996.625,2001.485,2001.485,1996.877,1991.792,1995.291,1996.291,1995.959,1993.877,1995.625,1992.127,2004.600,1997.644,1996.625,1995.540,1996.373,2000.507,1999.630,1997.546,1999.576,1998.707,2000.628,2001.688,2001.094,2001.493,2001.773,2002.713,2001.948,2007.452,2009.233,2010.321,2012.973,2010.589,2009.488,2011.578,2001.198,1996.540,2002.020,2003.502,2008.543,1998.691,1998.691,2002.562,1996.458,1999.006,1996.540,1996.710,1997.554,1997.584,1996.710,2004.808,1999.704,2002.272,1997.959,2001.556,2002.329,2002.039,2005.420,2005.433,2003.671,2008.795,2009.565,1995.291,1998.592,1992.792,1994.458,1995.877,1996.291,1995.373,1994.959,1997.384,2002.176,1997.611,1995.877,1996.792,1994.959,1994.959,1998.258,1995.044,1995.044,1994.044,1995.959,1995.959,1995.959,1996.291,1997.748,1994.540,1995.206,1995.044,1997.422,1994.540,1996.540,1999.666,1995.877,1995.792,1997.970,1997.211,1997.211,1995.625,1998.726,1997.463,1998.417,1996.540,1996.792,1996.792,1996.877,1999.376,1994.129,1995.877,2000.581,2000.797,2001.589,2004.283,2010.195,2001.321,2002.485,2001.562,2002.540,1997.734,2002.012,1998.493,2000.934,2001.061,2000.710,1999.556,1996.710,1996.710,1996.710,2000.570,2004.439,2007.562,2009.012,2000.707,1997.729,2000.836,2001.351,2010.138,2002.603,2004.682,2008.017,1999.581,1998.866,1998.866,1997.644,1997.863,1994.792,1995.625,1994.877,1996.710,1996.710,2002.157,2005.565,2003.636,2006.997,1998.458,1998.458,1995.625,1999.417,2000.641,2001.921,2000.329,2001.483,2001.066,2004.786,1999.912,2002.565,2009.392,1999.409,2002.236,1997.524,1996.710,2000.502,1999.660,2000.266,2004.710,2005.855,2001.997,2000.242,1999.863,1999.693,1998.817,1998.682,1999.129,2000.765,2001.751,2003.562,2001.447,2004.496,1997.562,1998.480,1998.677,1997.682,2003.633,1997.595,1998.389,1995.625,1997.734,1997.403,1997.403,2002.671,2002.841,2002.707,1995.373,2000.291,1996.540,1996.291,1999.671,1995.710,1995.710,1999.403,1995.877,1997.573,1996.710,1998.450,1999.491,2005.080,2007.682,1996.792,1997.871,1995.877,2000.696,2002.124,1998.392,1998.392,1996.206,1996.291,1999.682,2000.696,2000.420,1997.444,2000.389,2001.543,1999.228,1996.625,1999.737,1996.540,1994.792,1995.710,1995.625,1996.540,2000.129,2000.817,2001.677,2001.759,2001.759,2002.118,2003.567,2012.357,1998.975,2000.833,1999.513,2001.975,1995.792,2002.641,2002.852,1997.885,1999.444,1997.253,1999.532,2005.869,1998.984,1997.250,1999.874,2000.770,2001.838,2002.420,2003.611,2007.165,2000.800,1999.710,1998.389,2005.885,1994.373,1997.699,1997.699,1995.625,1996.458,1996.877,1996.373,1996.206,1999.135,1999.198,1998.765,1998.179,1996.625,1995.710,1995.710,1994.792,1995.540,1995.458,1995.540,1994.877,1996.540,1996.540,1995.625,2016.474,2007.521,2003.023,2003.023,2004.567,2003.639,2003.526,1997.165,2001.474,2001.529,1997.888,2000.463,2001.625,2001.373,2002.524,
        2002.636,1999.157,1997.792,1994.792,1996.792,1997.658,1994.540,1996.625,2000.373,2005.567,2000.431,1996.877,1997.803,2000.493,1999.483,2003.532,1995.540,1995.625,2001.740,1999.953,2001.113,2004.272,2006.433,2012.663,2001.452,2002.970,2002.970,2002.258,1995.458,1998.228,1997.630,1997.630,2001.912,1993.792,1995.710,1994.710,1994.625,1995.206,2007.253,1993.625,2014.647,2014.666,2014.669,2017.740,2013.012,2011.592,2009.483,1997.428,2001.666,2008.414,2001.852,2002.611,1999.064,1997.554,1994.458,1994.458,1995.792,2002.562,2003.710,1999.691,2014.606,2010.863,1997.636,2003.061,2004.584)

dates



plot(t)

pdf(file="./154_root_to_tip_correlation.pdf")
root_to_tip_correlation <-roottotip(t,dates, rate=NA,permTest = 10000, showFig=T, colored = T,showPredInt = "gamma", showText=T, showTree = T)
dev.off()

#?bactdate
res=bactdate(t,dates,useRec=T, nbIts=1e6)
?bactdate
#res=bactdate(t,dates,useRec=T)
res
#write.csv(res,"./154_1e6_res.csv", row.names = FALSE)


pdf(file="./1541e6_MCMCTrace.pdf")
plot(res, 'trace')
dev.off()



pdf(file="./1541e6_time_Bactdating.pdf")
plot(res,'treeCI')
dev.off()


#export the result
l=as.treedata.resBactDating(res)
l
library(treeio)
obj=methods::new('treedata',phylo=l[[1]],data=dplyr::tbl_df(as.data.frame(l[[2]])))
obj
write.beast(obj,'154_965_treeBactDating1e6.nex')

library(ape)
library(geiger)
library(skygrowth)
library(ggplot2)
library(phylodyn)
library(ggtree)
getwd()
mcmc42<-read.nexus("./154_965_treeBactDating1e6.nex")
mcmc42
plot(mcmc42)

ggtree(mcmc42, mrsd="2019-12-01")+ theme_tree2()



